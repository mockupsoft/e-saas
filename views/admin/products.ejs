<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S√ºper Admin - √úr√ºn Y√∂netimi</title>
    <link rel="stylesheet" href="/css/dashboard.css">
    <link rel="stylesheet" href="/css/components.css">
    <script src="https://unpkg.com/htmx.org@1.9.12"></script>
    <meta name="csrf-token" content="<%= typeof csrfToken !== 'undefined' ? csrfToken : '' %>">
</head>
<body class="admin">
    <div class="dashboard-layout">
        <!-- Sidebar -->
        <nav class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <div class="logo-icon">üöÄ</div>
                    <span class="logo-text">S√ºper Admin</span>
                </div>
                <button class="sidebar-toggle">‚úï</button>
            </div>
            
            <div class="sidebar-nav">
                <div class="nav-section">
                    <div class="nav-section-title">Ana Men√º</div>
                    <div class="nav-item">
                        <a href="/admin/dashboard" class="nav-link">
                            <div class="nav-icon">üìä</div>
                            <span class="nav-text">Dashboard</span>
                        </a>
                    </div>
                    <div class="nav-item">
                        <a href="/admin/tenants" class="nav-link">
                            <div class="nav-icon">üë•</div>
                            <span class="nav-text">Tenant Y√∂netimi</span>
                        </a>
                    </div>
                    <div class="nav-item">
                        <a href="/admin/products" class="nav-link active">
                            <div class="nav-icon">üì¶</div>
                            <span class="nav-text">√úr√ºn Y√∂netimi</span>
                        </a>
                    </div>
                </div>
                
                <div class="nav-section">
                    <div class="nav-section-title">ƒ∞zleme</div>
                    <div class="nav-item">
                        <a href="/admin/analytics" class="nav-link">
                            <div class="nav-icon">üìà</div>
                            <span class="nav-text">Analytics</span>
                        </a>
                    </div>
                    <div class="nav-item">
                        <a href="/admin/logs" class="nav-link">
                            <div class="nav-icon">üìã</div>
                            <span class="nav-text">Sistem Loglarƒ±</span>
                        </a>
                    </div>
                </div>
                
                <div class="nav-section">
                    <div class="nav-section-title">Mobil</div>
                    <div class="nav-item">
                        <a href="/admin/mobile" class="nav-link">
                            <div class="nav-icon">üì±</div>
                            <span class="nav-text">Mobil Uygulama</span>
                        </a>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Top Bar -->
            <header class="top-bar">
                <h1 class="page-title">üì¶ √úr√ºn Y√∂netimi</h1>
                <div class="top-bar-actions">
                    <button class="mobile-menu-btn">‚ò∞</button>
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <!-- Tenant Filter -->
                        <%- include('../partials/components/form-group', {
                            id: 'tenant_filter',
                            name: 'tenant_filter',
                            type: 'select',
                            options: [
                                { value: '', text: 'T√ºm Tenant\'lar' },
                                ...tenants.map(t => ({ value: t.id, text: t.name }))
                            ],
                            attributes: {
                                'hx-get': '/admin/api/products',
                                'hx-target': '#productsTable tbody',
                                'hx-swap': 'outerHTML',
                                'hx-trigger': 'change'
                            }
                        }) %>
                        <span class="total-count"><%= totalProducts %> √úr√ºn</span>
                    </div>
                </div>
            </header>

            <!-- Content -->
            <div class="content">
                <!-- Stats Cards -->
                <div class="stats-grid" style="margin-bottom: 2rem;">
                    <div class="stat-card">
                        <div class="stat-icon">üì¶</div>
                        <div class="stat-number"><%= totalProducts %></div>
                        <div class="stat-label">Toplam √úr√ºn</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üè¢</div>
                        <div class="stat-number"><%= tenants.length %></div>
                        <div class="stat-label">Aktif Tenant</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">‚ö†Ô∏è</div>
                        <div class="stat-number"><%= lowStockCount %></div>
                        <div class="stat-label">D√º≈ü√ºk Stok</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üí∞</div>
                        <div class="stat-number">‚Ç∫<%= totalValue.toLocaleString('tr-TR') %></div>
                        <div class="stat-label">Toplam Stok Deƒüeri</div>
                    </div>
                </div>

                <!-- Products Table -->
                <%- include('../partials/components/table', {
                    id: 'productsTable',
                    title: '√úr√ºn Listesi',
                    headers: [
                        { text: 'ID', key: 'id' },
                        { text: 'Tenant', key: 'tenant' },
                        { text: '√úr√ºn Adƒ±', key: 'name' },
                        { text: 'Fiyat', key: 'price' },
                        { text: 'Stok', key: 'stock_quantity' },
                        { text: 'Durum', key: 'status' },
                        { text: 'Olu≈üturma Tarihi', key: 'created_at' },
                        { text: 'ƒ∞≈ülemler', key: 'actions' }
                    ],
                    data: products.map(product => ({
                        id: product.id,
                        tenant: `<span style="font-size: 0.875rem; background: #f3f4f6; padding: 2px 6px; border-radius: 4px;">${product.tenant_name}</span>`,
                        name: `<strong>${product.name}</strong>`,
                        price: `‚Ç∫${parseFloat(product.price).toLocaleString('tr-TR')}`,
                        stock_quantity: product.stock_quantity <= 5 ? 
                            `<span style="color: #dc2626; font-weight: 600;">${product.stock_quantity}</span>` : 
                            product.stock_quantity,
                        status: `<%- include('../partials/components/status-badge', {
                            status: '${product.status}',
                            text: '${product.status === 'active' ? 'Aktif' : 'Pasif'}'
                        }) %>`,
                        created_at: new Date(product.created_at).toLocaleDateString('tr-TR'),
                        actions: `
                            <div style="display: flex; gap: 0.5rem;">
                                <a href="/${product.tenant_domain}/products" target="_blank" 
                                   class="btn-sm btn-outline">
                                    üëÅÔ∏è G√∂r√ºnt√ºle
                                </a>
                                <%- include('../partials/components/button', {
                                    type: 'outline',
                                    text: 'Detay',
                                    icon: '‚ÑπÔ∏è',
                                    size: 'sm',
                                    action: 'view-product-detail',
                                    attributes: { 
                                        'data-product-id': '${product.id}',
                                        'data-tenant-id': '${product.tenant_id}'
                                    }
                                }) %>
                            </div>
                        `
                    })),
                    emptyState: {
                        icon: 'üì¶',
                        title: 'Hen√ºz √ºr√ºn bulunmuyor',
                        description: 'Tenant\'lar √ºr√ºn eklemeye ba≈üladƒ±ƒüƒ±nda burada g√∂r√ºnecek.',
                        action: null
                    }
                }) %>
            </div>
        </main>
    </div>

    <!-- Product Detail Modal -->
    <%- include('../partials/components/modal', {
        id: 'productDetailModal',
        title: '√úr√ºn Detayƒ±',
        size: 'lg',
        content: `
            <div class="modal-body">
                <div id="productDetailContent">
                    <!-- Content will be loaded dynamically -->
                </div>
            </div>
            <div class="modal-footer">
                <%- include('../partials/components/button', {
                    type: 'secondary',
                    text: 'Kapat',
                    action: 'close-product-detail-modal'
                }) %>
            </div>
        `
    }) %>

    <!-- Scripts -->
    <script src="/js/ui.js"></script>
    <script src="/js/dashboard.js"></script>
    <script>
        // Initialize admin product management
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof window.initializeAdminProductManagement === 'function') {
                window.initializeAdminProductManagement();
            }
        });
    </script>
</body>
</html> 